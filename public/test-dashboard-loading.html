<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Loading Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; border-radius: 5px; }
        .success { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
        .error { border-color: #ff4444; background: rgba(255, 68, 68, 0.1); }
        .info { border-color: #4488ff; background: rgba(68, 136, 255, 0.1); }
    </style>
</head>
<body>
    <h1>Dashboard Loading Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
        }

        addResult('✅ JavaScript is executing', 'success');
        addResult('✅ Page loaded successfully', 'success');

        // Test if we can access the dashboard
        addResult('Testing dashboard access...', 'info');

        // Try to load the dashboard
        fetch('http://localhost:8080/')
            .then(response => {
                if (response.ok) {
                    addResult('✅ Dashboard page loads successfully', 'success');
                    return response.text();
                } else {
                    addResult('❌ Dashboard page failed to load: ' + response.status, 'error');
                    throw new Error('Dashboard load failed');
                }
            })
            .then(html => {
                addResult('✅ Dashboard HTML received (' + html.length + ' characters)', 'success');

                // Check if the HTML contains the expected JavaScript
                if (html.includes('connectWebSocket')) {
                    addResult('✅ Dashboard contains WebSocket connection code', 'success');
                } else {
                    addResult('❌ Dashboard missing WebSocket connection code', 'error');
                }

                if (html.includes('new WebSocket')) {
                    addResult('✅ Dashboard contains WebSocket instantiation', 'success');
                } else {
                    addResult('❌ Dashboard missing WebSocket instantiation', 'error');
                }
            })
            .catch(error => {
                addResult('❌ Error loading dashboard: ' + error.message, 'error');
            });

        // Test WebSocket connection directly
        addResult('Testing WebSocket connection...', 'info');

        try {
            const ws = new WebSocket('ws://localhost:8080');

            ws.onopen = () => {
                addResult('✅ WebSocket connection successful', 'success');
                ws.close();
            };

            ws.onerror = (error) => {
                addResult('❌ WebSocket connection failed: ' + error, 'error');
            };

            ws.onclose = (event) => {
                addResult('WebSocket closed: ' + event.code + ' - ' + event.reason, 'info');
            };

        } catch (error) {
            addResult('❌ WebSocket creation failed: ' + error.message, 'error');
        }
    </script>
</body>
</html>
