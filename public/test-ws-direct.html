<!DOCTYPE html>
<html>
<head>
    <title>Direct WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .status { font-size: 18px; font-weight: bold; margin: 20px 0; }
        .connected { color: #00ff88; }
        .disconnected { color: #ff4444; }
        .connecting { color: #ffaa00; }
        #log { background: #2a2a2a; padding: 10px; border-radius: 5px; height: 300px; overflow-y: auto; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Direct WebSocket Test</h1>
    <div id="status" class="connecting">Connecting...</div>
    <div id="log"></div>

    <script>
        const status = document.getElementById('status');
        const log = document.getElementById('log');

        function addLog(message) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        addLog('Starting direct WebSocket test...');
        addLog('Attempting to connect to ws://localhost:8080');

        // Test WebSocket connection
        const ws = new WebSocket('ws://localhost:8080');

        ws.onopen = () => {
            status.textContent = 'Connected';
            status.className = 'connected';
            addLog('‚úÖ WebSocket connected successfully!');
            addLog('Sending test message...');
            ws.send(JSON.stringify({test: 'hello'}));
        };

        ws.onmessage = (event) => {
            addLog('üì® Received: ' + event.data);
        };

        ws.onclose = (event) => {
            status.textContent = 'Disconnected';
            status.className = 'disconnected';
            addLog('‚ùå WebSocket disconnected. Code: ' + event.code + ', Reason: ' + event.reason);
        };

        ws.onerror = (error) => {
            status.textContent = 'Error';
            status.className = 'disconnected';
            addLog('‚ùå WebSocket error: ' + error);
        };

        // Also test the dashboard's connection logic
        setTimeout(() => {
            addLog('Testing dashboard connection logic...');
            try {
                const dashboardWs = new WebSocket('ws://localhost:8080');
                dashboardWs.onopen = () => addLog('‚úÖ Dashboard WebSocket also connected!');
                dashboardWs.onerror = (e) => addLog('‚ùå Dashboard WebSocket error: ' + e);
            } catch (e) {
                addLog('‚ùå Dashboard WebSocket creation failed: ' + e.message);
            }
        }, 2000);
    </script>
</body>
</html>
