<!DOCTYPE html>
<html>
<head>
    <title>Dashboard Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .success { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
        .error { border-color: #ff4444; background: rgba(255, 68, 68, 0.1); }
        .loading { border-color: #ffaa00; background: rgba(255, 170, 0, 0.1); }
        pre { background: #2a2a2a; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Dashboard Debug Test</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function addResult(title, status, data) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            results.appendChild(div);
        }

        async function testEndpoint(url, name) {
            addResult(`${name} - Testing...`, 'loading', { url });

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    addResult(`${name} - SUCCESS`, 'success', {
                        status: response.status,
                        data: data
                    });
                } else {
                    addResult(`${name} - HTTP ERROR`, 'error', {
                        status: response.status,
                        statusText: response.statusText,
                        data: data
                    });
                }
            } catch (error) {
                addResult(`${name} - FETCH ERROR`, 'error', {
                    error: error.message,
                    stack: error.stack
                });
            }
        }

        // Test all endpoints
        testEndpoint('http://localhost:8080/health', 'Health');
        testEndpoint('http://localhost:8080/tools', 'Tools');
        testEndpoint('http://localhost:8080/metrics', 'Metrics');
        testEndpoint('http://localhost:8080/workflows', 'Workflows');

        // Test WebSocket
        try {
            const ws = new WebSocket('ws://localhost:8080');
            ws.onopen = () => addResult('WebSocket - CONNECTED', 'success', { status: 'Connected' });
            ws.onerror = (error) => addResult('WebSocket - ERROR', 'error', { error: error });
            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    addResult('WebSocket - MESSAGE', 'success', { type: data.type, data: data });
                } catch (e) {
                    addResult('WebSocket - MESSAGE PARSE ERROR', 'error', { message: event.data, error: e.message });
                }
            };
        } catch (error) {
            addResult('WebSocket - CONNECTION ERROR', 'error', { error: error.message });
        }
    </script>
</body>
</html>
