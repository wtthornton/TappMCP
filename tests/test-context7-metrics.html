<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context7 Metrics Dashboard Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px;
            transition: background 0.2s;
        }
        .test-button:hover {
            background: #5a67d8;
        }
        .metrics-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            display: inline-block;
            margin: 5px;
        }
        .status-success { background: #10b981; color: white; }
        .status-error { background: #ef4444; color: white; }
        .status-info { background: #3b82f6; color: white; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Context7 Metrics Dashboard Test</h1>
            <p>Test the Context7 metrics tracking and dashboard functionality</p>
        </div>

        <div class="test-section">
            <h2>🧪 Test Controls</h2>
            <button class="test-button" onclick="testContext7Metrics()">Test Context7 Metrics</button>
            <button class="test-button" onclick="testDashboardGeneration()">Test Dashboard Generation</button>
            <button class="test-button" onclick="testCostTracking()">Test Cost Tracking</button>
            <button class="test-button" onclick="testQualityMetrics()">Test Quality Metrics</button>
            <button class="test-button" onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-section">
            <h2>📊 Test Results</h2>
            <div id="testResults" class="metrics-display">Click a test button to see results...</div>
        </div>

        <div class="test-section">
            <h2>🎯 Context7 Metrics Overview</h2>
            <div class="grid">
                <div class="card">
                    <h3>API Usage</h3>
                    <div id="apiUsage">Loading...</div>
                </div>
                <div class="card">
                    <h3>Cost Analysis</h3>
                    <div id="costAnalysis">Loading...</div>
                </div>
                <div class="card">
                    <h3>Knowledge Quality</h3>
                    <div id="knowledgeQuality">Loading...</div>
                </div>
                <div class="card">
                    <h3>Performance</h3>
                    <div id="performance">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock Context7 metrics data for testing
        const mockContext7Metrics = {
            apiUsage: {
                totalRequests: 156,
                requestsPerHour: [2, 4, 6, 8, 12, 15, 18, 20, 16, 14, 12, 10, 8, 6, 4, 2, 1, 3, 5, 7, 9, 11, 13, 15],
                endpointUsage: {
                    'documentation': 45,
                    'codeExamples': 38,
                    'bestPractices': 32,
                    'troubleshooting': 25,
                    'search': 16
                },
                rateLimitUtilization: 0.65,
                tokenUsage: 125430,
                costPerRequest: 0.0008,
                totalCost: 0.1248
            },
            knowledgeQuality: {
                averageRelevanceScore: 0.87,
                userSatisfactionScore: 0.82,
                contentEffectiveness: {
                    'react': 0.92,
                    'typescript': 0.89,
                    'nodejs': 0.85,
                    'javascript': 0.88
                },
                topicPopularity: {
                    'react': 45,
                    'typescript': 38,
                    'nodejs': 32,
                    'javascript': 28,
                    'nextjs': 25
                },
                knowledgeSourcePerformance: {
                    'context7': 0.89,
                    'cache': 0.95,
                    'fallback': 0.72
                }
            },
            performance: {
                averageResponseTime: 1250,
                cacheHitRate: 0.78,
                errorRate: 0.03,
                uptime: 86400000,
                batchEfficiency: 0.85,
                fallbackUsage: 0.12
            },
            cost: {
                totalCost: 0.1248,
                costPerHour: [0.002, 0.004, 0.006, 0.008, 0.012, 0.015, 0.018, 0.020, 0.016, 0.014, 0.012, 0.010, 0.008, 0.006, 0.004, 0.002, 0.001, 0.003, 0.005, 0.007, 0.009, 0.011, 0.013, 0.015],
                budgetUtilization: 0.25,
                projectedMonthlyCost: 3.74,
                costOptimizationSavings: 0.45
            }
        };

        function log(message) {
            const results = document.getElementById('testResults');
            results.textContent += message + '\n';
            results.scrollTop = results.scrollHeight;
        }

        function testContext7Metrics() {
            log('🧪 Testing Context7 Metrics Collection...');

            // Simulate recording metrics
            const testRequests = [
                { endpoint: 'documentation', topic: 'react', success: true, responseTime: 1200, tokenUsage: 150, cost: 0.0015, knowledgeSource: 'context7' },
                { endpoint: 'codeExamples', topic: 'typescript', success: true, responseTime: 980, tokenUsage: 200, cost: 0.002, knowledgeSource: 'context7' },
                { endpoint: 'bestPractices', topic: 'nodejs', success: false, responseTime: 5000, tokenUsage: 0, cost: 0, knowledgeSource: 'error' },
                { endpoint: 'troubleshooting', topic: 'javascript', success: true, responseTime: 800, tokenUsage: 120, cost: 0.0012, knowledgeSource: 'cache' }
            ];

            testRequests.forEach((req, index) => {
                log(`  Request ${index + 1}: ${req.endpoint} - ${req.topic} - ${req.success ? 'SUCCESS' : 'FAILED'} - ${req.responseTime}ms - ${req.tokenUsage} tokens - $${req.cost.toFixed(6)}`);
            });

            log('✅ Context7 metrics collection test completed!');
            updateMetricsDisplay();
        }

        function testDashboardGeneration() {
            log('🧪 Testing Dashboard Generation...');

            try {
                // Simulate dashboard generation
                const dashboardHTML = generateMockDashboard();
                log('✅ Dashboard HTML generated successfully!');
                log(`📊 Dashboard contains ${dashboardHTML.length} characters`);
                log('🎯 Context7 metrics section included');
                log('💰 Cost analysis cards added');
                log('📚 Knowledge quality metrics displayed');
                log('⚡ Performance monitoring active');
            } catch (error) {
                log(`❌ Dashboard generation failed: ${error.message}`);
            }
        }

        function testCostTracking() {
            log('🧪 Testing Cost Tracking...');

            const costAnalysis = mockContext7Metrics.cost;
            log(`💰 Total Cost: $${costAnalysis.totalCost.toFixed(4)}`);
            log(`💰 Cost per Request: $${(costAnalysis.totalCost / mockContext7Metrics.apiUsage.totalRequests).toFixed(6)}`);
            log(`💰 Projected Monthly: $${costAnalysis.projectedMonthlyCost.toFixed(2)}`);
            log(`💰 Budget Utilization: ${(costAnalysis.budgetUtilization * 100).toFixed(1)}%`);
            log(`💰 Optimization Savings: $${costAnalysis.costOptimizationSavings.toFixed(2)}`);

            log('✅ Cost tracking test completed!');
        }

        function testQualityMetrics() {
            log('🧪 Testing Quality Metrics...');

            const quality = mockContext7Metrics.knowledgeQuality;
            log(`📚 Average Relevance Score: ${quality.averageRelevanceScore.toFixed(2)}`);
            log(`📚 User Satisfaction: ${quality.userSatisfactionScore.toFixed(2)}`);
            log(`📚 Knowledge Sources: ${Object.keys(quality.knowledgeSourcePerformance).length}`);

            log('📈 Top Topics:');
            Object.entries(quality.topicPopularity)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .forEach(([topic, count]) => {
                    log(`  ${topic}: ${count} requests`);
                });

            log('✅ Quality metrics test completed!');
        }

        function generateMockDashboard() {
            return `
                <div class="context7-section">
                    <h2>🎯 Context7 Intelligence Metrics</h2>
                    <div class="grid">
                        <div class="card">
                            <h3>🎯 Context7 Overview</h3>
                            <div>Total API Requests: ${mockContext7Metrics.apiUsage.totalRequests}</div>
                            <div>Success Rate: ${(mockContext7Metrics.performance.errorRate < 0.1 ? '90%+' : 'Below 90%')}</div>
                            <div>Avg Response Time: ${mockContext7Metrics.performance.averageResponseTime}ms</div>
                            <div>Total Cost: $${mockContext7Metrics.cost.totalCost.toFixed(4)}</div>
                        </div>
                        <div class="card">
                            <h3>💰 Cost Analysis</h3>
                            <div>Total Cost: $${mockContext7Metrics.cost.totalCost.toFixed(4)}</div>
                            <div>Projected Monthly: $${mockContext7Metrics.cost.projectedMonthlyCost.toFixed(2)}</div>
                            <div>Budget Utilization: ${(mockContext7Metrics.cost.budgetUtilization * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateMetricsDisplay() {
            const apiUsage = document.getElementById('apiUsage');
            const costAnalysis = document.getElementById('costAnalysis');
            const knowledgeQuality = document.getElementById('knowledgeQuality');
            const performance = document.getElementById('performance');

            apiUsage.innerHTML = `
                <div>Total Requests: ${mockContext7Metrics.apiUsage.totalRequests}</div>
                <div>Token Usage: ${mockContext7Metrics.apiUsage.tokenUsage.toLocaleString()}</div>
                <div>Rate Limit: ${(mockContext7Metrics.apiUsage.rateLimitUtilization * 100).toFixed(1)}%</div>
                <div>Endpoints: ${Object.keys(mockContext7Metrics.apiUsage.endpointUsage).length}</div>
            `;

            costAnalysis.innerHTML = `
                <div>Total Cost: $${mockContext7Metrics.cost.totalCost.toFixed(4)}</div>
                <div>Per Request: $${mockContext7Metrics.apiUsage.costPerRequest.toFixed(6)}</div>
                <div>Monthly Projection: $${mockContext7Metrics.cost.projectedMonthlyCost.toFixed(2)}</div>
                <div>Budget Used: ${(mockContext7Metrics.cost.budgetUtilization * 100).toFixed(1)}%</div>
            `;

            knowledgeQuality.innerHTML = `
                <div>Relevance Score: ${mockContext7Metrics.knowledgeQuality.averageRelevanceScore.toFixed(2)}</div>
                <div>User Satisfaction: ${mockContext7Metrics.knowledgeQuality.userSatisfactionScore.toFixed(2)}</div>
                <div>Sources: ${Object.keys(mockContext7Metrics.knowledgeQuality.knowledgeSourcePerformance).length}</div>
                <div>Top Topic: ${Object.entries(mockContext7Metrics.knowledgeQuality.topicPopularity).sort(([,a], [,b]) => b - a)[0][0]}</div>
            `;

            performance.innerHTML = `
                <div>Response Time: ${mockContext7Metrics.performance.averageResponseTime}ms</div>
                <div>Cache Hit Rate: ${(mockContext7Metrics.performance.cacheHitRate * 100).toFixed(1)}%</div>
                <div>Error Rate: ${(mockContext7Metrics.performance.errorRate * 100).toFixed(1)}%</div>
                <div>Batch Efficiency: ${(mockContext7Metrics.performance.batchEfficiency * 100).toFixed(1)}%</div>
            `;
        }

        function clearResults() {
            document.getElementById('testResults').textContent = 'Click a test button to see results...';
        }

        // Initialize the display
        updateMetricsDisplay();
    </script>
</body>
</html>
